学习笔记

这周主要学习了对已计算好CSS属性的DOM元素进行排版尺寸计算，并将计算好的位图渲染出来，总结了主要为以下几点：

1. 根据浏览器属性进行排版
    + 这里toy browser主要用的flex布局，flex布局需要知道所有子元素，所以我们会在标签闭合的时候对元素进行排版方法调用
    + 处理排版之前首先会对element的属性做一些预处理，将属性中“px”属性转为整型，并创建一个对象来处理最后处理过后的属性，这里用了style字段，实际上style属性被另有所用，这里只是为了方便
    + 做一些flex布局的属性初始化操作，根据当前flex相关属性，抽象出主轴、交叉轴的各个属性
    + 因之后是要得到一个位图，所以最终属性中除了主轴、交叉轴的尺寸，还有当前元素的位置（left，right，top，bottom）

2. 收集元素入行，根据当前flex属性将元素入行分为多个情况
    + 若flexWrap属性为nowrap，并且父元素由子元素撑开即依次入行，并且行高为子元素中交叉轴尺寸最大的那个元素的交叉轴尺寸
    + 若flexWrap属性为nowrap，父元素有主轴尺寸，但当父元素的剩余空间不满足装下剩余的子元素时，此时会排入同一行，所有子元素按比例压缩排列
    + 若flexWrap属性为可换行时，当子元素主轴尺寸大于父元素的剩余空间时则直接换行，同时记录下上一行的主轴剩余空间和交叉轴剩余空间

3. 计算主轴
    + 一种特殊情况，当flexWrap不可换行时，主轴剩余空间小于剩下子元素的主轴尺寸，这时如果子元素有flex属性的，则尺寸为0，否则其尺寸需要按一定比例压缩。
    + 计算带flex属性的子元素尺寸时，需要将剩余空间 / 带flex属性的个数 * flex的属性值才能算出其尺寸
    + 对于不含有flex属性的子元素的父元素布局时，则要根据justify-content的规则去分配

4. 计算交叉轴
    + 其逻辑跟计算主轴类似，其除了受父元素属性alignContent影响以为还收子元素属性alignSelf，alignItems影响

5. 绘制元素
    + 在得到整棵已计算好位图属性的DOM树后需要将DOM树渲染成图片显示出来，这里因使用的node环境，所以用的iamges作为渲染工具
    + 通过递归的方式，对DOM树种的各个位图进行绘制（DOM位置呈现根据DOM属性中的width、height、left、right、top、right进行绘制）